"use strict";function initApp(){viewModel.init(),ko.applyBindings(viewModel)}function mapFail(){alert("Google Maps failed to load. Please contact Larry.")}var model={locations:[{name:"Cohaesus Projects Ltd",lat:"51.524288",lng:"-0.096178",about:"The office. You work here."},{name:"The Fountain",lat:"51.526938",lng:"-0.088713",about:"Local pub. Good beer selection."},{name:"Old Street Market",lat:"51.523658",lng:"-0.093210",about:"Great place for lunch."},{name:"Finsbury Leisure Centre",lat:"51.526212",lng:"-0.095253",about:"Local gym / fitness centre."},{name:"Vibast Community Centre",lat:"51.525467",lng:"-0.092290",about:"Conducts Salah"}]},viewModel={getMarkers:function(){return model.locations},init:function(){function e(e){var n=new RegExp(t.currentSearch(),"i");return n.exec(e.name)||n.exec(e.about)}var t=this,n=this.getMarkers();this.items=ko.observableArray(),this.currentSearch=ko.observable(""),this.filteredItems=ko.computed(function(){return t.items().filter(e)}),listView.init(),mapView.init(),this.items(n)}},listView={init:function(){this.pointOfInterest=document.getElementById("poi-list"),this.render()},render:function(){this.listClick=function(e){function t(e,t,n){for(var a=0;a<e.length;a+=1)if(e[a][t]===n)return a}var n=t(mapView.markers,"name",e.name),a=mapView.markers[n];mapView.toggleBounce(a),mapView.infoWindow(e,a)}}},mapView={init:function(){this.mapElem=document.getElementById("map"),this.render()},render:function(){var e=this;this.mapOldSt={center:new google.maps.LatLng(51.524288,-.096178),zoom:16,mapTypeId:google.maps.MapTypeId.ROADMAP},this.mapElem=new google.maps.Map(document.getElementById("map"),this.mapOldSt),this.markers=[],viewModel.filteredItems.subscribe(function(t){e.markers.forEach(function(e){e.setMap(null)}),e.markers=t.map(e.plotMarkers)}),this.mapMarkers=function(e){var t={animation:google.maps.Animation.DROP,position:new google.maps.LatLng(e.lat,e.lng)},n=new google.maps.Marker(t);return n.name=e.name,n},this.plotMarkers=function(t){var n=e.mapMarkers(t);return n.setMap(e.mapElem),google.maps.event.addListener(n,"click",function(){e.toggleBounce(n),e.infoWindow(t,n)}),n},this.toggleBounce=function(e){null!==e.getAnimation()?e.setAnimation(null):e.setAnimation(google.maps.Animation.BOUNCE)},this.infoWindow=function(t,n){var a,o;$.ajax({type:"GET",url:"https://api.foursquare.com/v2/venues/search?ll="+t.lat+","+t.lng+"&client_id=WX4CJA0TCWQ3MW0BBZI4XR1QSMOBMUE3ZCUMQJDGQSY4NQSR&client_secret=J3PRLH35JLIHEUITLLKRTY1JWNZIR2LB50ODVXTUFKYRJJEG&v=20160317",data:{format:"json"},error:function(){alert("An error has occurred. Sorry about that!")},dataType:"jsonp",success:function(i){var r="<h3>"+t.name+'</h3><div id="bodyContent"><h4>'+i.response.venues[0].location.address+"</h4><p>"+t.about+"</p>";o={content:r},a=new google.maps.InfoWindow(o),a.open(e.mapElem,n)}})}}};